{"remainingRequest":"/Users/apple/WebstormProjects/vue-demo/erp-web/erp-web/node_modules/babel-loader/lib/index.js!/Users/apple/WebstormProjects/vue-demo/erp-web/erp-web/node_modules/eslint-loader/index.js??ref--13-0!/Users/apple/WebstormProjects/vue-demo/erp-web/erp-web/src/utils/request.js","dependencies":[{"path":"/Users/apple/WebstormProjects/vue-demo/erp-web/erp-web/src/utils/request.js","mtime":1569293028377},{"path":"/Users/apple/WebstormProjects/vue-demo/erp-web/erp-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/apple/WebstormProjects/vue-demo/erp-web/erp-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/apple/WebstormProjects/vue-demo/erp-web/erp-web/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"/Users/apple/WebstormProjects/vue-demo/erp-web/erp-web/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _axios = _interopRequireDefault(require(\"axios\"));\n\nvar _elementUi = require(\"element-ui\");\n\nvar _store = _interopRequireDefault(require(\"@/store\"));\n\nvar _auth = require(\"@/utils/auth\");\n\nvar service = _axios.default.create({\n  baseURL: process.env.VUE_APP_BASE_API,\n  timeout: 5000\n});\n\nservice.interceptors.request.use(function (config) {\n  if (_store.default.getters.token) {\n    config.headers['X-Token'] = (0, _auth.getToken)();\n  }\n\n  return config;\n}, function (error) {\n  console.info(error);\n  return Promise.reject(error);\n});\nservice.interceptors.response.use(function (response) {\n  var res = response.data;\n\n  if (res.code != 20000) {\n    (0, _elementUi.Message)({\n      message: res.message || 'Error',\n      type: 'error',\n      duration: 5 * 1000\n    }); // 50008: Illegal token; 50012: Other clients logged in; 50014: Token expired;\n\n    if (res.code === 50008 || res.code === 50012 || res.code === 50014) {\n      _elementUi.MessageBox.confirm('You have been logged out, you can cancel to stay on this page, or log in again', 'Confirm logout', {\n        confirmButtonText: '重新登陆',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function () {\n        _store.default.dispatch(\"user/resetToken\").then(function () {\n          location.reload();\n        });\n      });\n    }\n\n    return Promise.reject(new Error(res.message || 'Error'));\n  } else {\n    return res;\n  }\n}, function (error) {\n  console.log('err' + error); // for debug\n\n  (0, _elementUi.Message)({\n    message: error.message,\n    type: 'error',\n    duration: 5 * 1000\n  });\n  return Promise.reject(error);\n});\nvar _default = service;\nexports.default = _default;",{"version":3,"sources":["/Users/apple/WebstormProjects/vue-demo/erp-web/erp-web/src/utils/request.js"],"names":["service","axios","create","baseURL","process","env","VUE_APP_BASE_API","timeout","interceptors","request","use","config","store","getters","token","headers","error","console","info","Promise","reject","response","res","data","code","message","type","duration","MessageBox","confirm","confirmButtonText","cancelButtonText","then","dispatch","location","reload","Error","log"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AAEA,IAAMA,OAAO,GAAGC,eAAMC,MAAN,CAAa;AACzBC,EAAAA,OAAO,EAAEC,OAAO,CAACC,GAAR,CAAYC,gBADI;AAEzBC,EAAAA,OAAO,EAAE;AAFgB,CAAb,CAAhB;;AAKAP,OAAO,CAACQ,YAAR,CAAqBC,OAArB,CAA6BC,GAA7B,CACI,UAAAC,MAAM,EAAI;AACN,MAAGC,eAAMC,OAAN,CAAcC,KAAjB,EAAuB;AACnBH,IAAAA,MAAM,CAACI,OAAP,CAAe,SAAf,IAA4B,qBAA5B;AACH;;AACD,SAAOJ,MAAP;AACH,CANL,EAOI,UAAAK,KAAK,EAAI;AACLC,EAAAA,OAAO,CAACC,IAAR,CAAaF,KAAb;AACA,SAAOG,OAAO,CAACC,MAAR,CAAeJ,KAAf,CAAP;AACH,CAVL;AAaAhB,OAAO,CAACQ,YAAR,CAAqBa,QAArB,CAA8BX,GAA9B,CACI,UAAAW,QAAQ,EAAI;AACR,MAAMC,GAAG,GAAGD,QAAQ,CAACE,IAArB;;AACA,MAAGD,GAAG,CAACE,IAAJ,IAAY,KAAf,EAAqB;AACjB,4BAAQ;AACJC,MAAAA,OAAO,EAAEH,GAAG,CAACG,OAAJ,IAAe,OADpB;AAEJC,MAAAA,IAAI,EAAE,OAFF;AAGJC,MAAAA,QAAQ,EAAE,IAAI;AAHV,KAAR,EADiB,CAOjB;;AACA,QAAIL,GAAG,CAACE,IAAJ,KAAa,KAAb,IAAsBF,GAAG,CAACE,IAAJ,KAAa,KAAnC,IAA4CF,GAAG,CAACE,IAAJ,KAAa,KAA7D,EAAoE;AAChEI,4BAAWC,OAAX,CAAmB,gFAAnB,EAAqG,gBAArG,EAAuH;AACnHC,QAAAA,iBAAiB,EAAE,MADgG;AAEnHC,QAAAA,gBAAgB,EAAE,IAFiG;AAGnHL,QAAAA,IAAI,EAAE;AAH6G,OAAvH,EAIGM,IAJH,CAIQ,YAAM;AACVpB,uBAAMqB,QAAN,CAAe,iBAAf,EAAkCD,IAAlC,CAAuC,YAAM;AACzCE,UAAAA,QAAQ,CAACC,MAAT;AACH,SAFD;AAGH,OARD;AASH;;AACD,WAAOhB,OAAO,CAACC,MAAR,CAAe,IAAIgB,KAAJ,CAAUd,GAAG,CAACG,OAAJ,IAAe,OAAzB,CAAf,CAAP;AACH,GApBD,MAoBO;AACH,WAAOH,GAAP;AACH;AACJ,CA1BL,EA2BI,UAAAN,KAAK,EAAI;AACLC,EAAAA,OAAO,CAACoB,GAAR,CAAY,QAAQrB,KAApB,EADK,CACsB;;AAC3B,0BAAQ;AACJS,IAAAA,OAAO,EAAET,KAAK,CAACS,OADX;AAEJC,IAAAA,IAAI,EAAE,OAFF;AAGJC,IAAAA,QAAQ,EAAE,IAAI;AAHV,GAAR;AAKA,SAAOR,OAAO,CAACC,MAAR,CAAeJ,KAAf,CAAP;AACH,CAnCL;eAsCehB,O","sourcesContent":["import axios from 'axios'\nimport { MessageBox, Message } from 'element-ui' // not in vue instance, then must import by yourself\nimport store from '@/store'\nimport { getToken } from '@/utils/auth'\n\nconst service = axios.create({\n    baseURL: process.env.VUE_APP_BASE_API,\n    timeout: 5000\n});\n\nservice.interceptors.request.use(\n    config => {\n        if(store.getters.token){\n            config.headers['X-Token'] = getToken()\n        }\n        return config;\n    },\n    error => {\n        console.info(error);\n        return Promise.reject(error);\n    }\n)\n\nservice.interceptors.response.use(\n    response => {\n        const res = response.data;\n        if(res.code != 20000){\n            Message({\n                message: res.message || 'Error',\n                type: 'error',\n                duration: 5 * 1000\n            })\n\n            // 50008: Illegal token; 50012: Other clients logged in; 50014: Token expired;\n            if (res.code === 50008 || res.code === 50012 || res.code === 50014) {\n                MessageBox.confirm('You have been logged out, you can cancel to stay on this page, or log in again', 'Confirm logout', {\n                    confirmButtonText: '重新登陆',\n                    cancelButtonText: '取消',\n                    type: 'warning'\n                }).then(() => {\n                    store.dispatch(\"user/resetToken\").then(() => {\n                        location.reload();\n                    })\n                })\n            }\n            return Promise.reject(new Error(res.message || 'Error'))\n        } else {\n            return res;\n        }\n    },\n    error => {\n        console.log('err' + error) // for debug\n        Message({\n            message: error.message,\n            type: 'error',\n            duration: 5 * 1000\n        })\n        return Promise.reject(error);\n    }\n)\n\nexport default service;"]}]}