{"remainingRequest":"/Users/apple/WebstormProjects/vue-demo/erp-web/erp-web/node_modules/babel-loader/lib/index.js!/Users/apple/WebstormProjects/vue-demo/erp-web/erp-web/node_modules/eslint-loader/index.js??ref--13-0!/Users/apple/WebstormProjects/vue-demo/erp-web/erp-web/src/store/modules/user.js","dependencies":[{"path":"/Users/apple/WebstormProjects/vue-demo/erp-web/erp-web/src/store/modules/user.js","mtime":1569293646636},{"path":"/Users/apple/WebstormProjects/vue-demo/erp-web/erp-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/apple/WebstormProjects/vue-demo/erp-web/erp-web/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/apple/WebstormProjects/vue-demo/erp-web/erp-web/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/es6.function.name\");\n\nvar _user = require(\"@/api/login/user\");\n\nvar _auth = require(\"@/utils/auth\");\n\nvar _router = require(\"@/router\");\n\nvar state = {\n  token: (0, _auth.getToken)(),\n  name: '',\n  avatar: '',\n  roles: []\n};\nvar mutations = {\n  SET_TOKEN: function SET_TOKEN(state, token) {\n    state.token = token;\n  },\n  SET_NAME: function SET_NAME(state, name) {\n    state.name = name;\n  },\n  SET_AVATAR: function SET_AVATAR(state, avatar) {\n    state.avatar = avatar;\n  },\n  SET_ROLES: function SET_ROLES(state, roles) {\n    state.roles = roles;\n  }\n};\nvar actions = {\n  login: function login(_ref, userInfo) {\n    var commit = _ref.commit;\n    var username = userInfo.username,\n        password = userInfo.password;\n    return new Promise(function (resolve, reject) {\n      (0, _user.login)({\n        username: username.trim(),\n        password: password\n      }).then(function (response) {\n        var data = response.data;\n        commit(\"SET_TOKEN\", data.token);\n        (0, _auth.setToken)(data.token);\n        resolve();\n      }).catch(function (err) {\n        reject(error);\n      });\n    });\n  },\n  logout: function logout(_ref2) {\n    var commit = _ref2.commit;\n    return new Promise(function (resolve, reject) {\n      (0, _user.logout)().then(function (response) {\n        commit('SET_TOKEN', '');\n        commit('SET_ROLES', []);\n        (0, _auth.removeToken)();\n        (0, _router.resetRouter)();\n        resolve();\n      }).catch(function (error) {\n        reject(error);\n      });\n    });\n  },\n  getUserInfo: function getUserInfo(_ref3) {\n    var commit = _ref3.commit,\n        state = _ref3.state;\n    return new Promise(function (resolve, reject) {\n      (0, _user.getInfo)(state.token).then(function (response) {\n        var data = response.data;\n\n        if (!data) {\n          reject('获取用户信息失败，请重新登陆！');\n        }\n\n        var roles = data.roles,\n            name = data.name,\n            avatar = data.avatar;\n\n        if (!roles || roles.length <= 0) {\n          reject('getInfo: roles must be a non-null array!');\n        }\n\n        commit('SET_ROLES', roles);\n        commit('SET_NAME', name);\n        commit('SET_AVATAR', avatar);\n        resolve(data);\n      }).catch(function (error) {\n        reject(error);\n      });\n    });\n  },\n  resetToken: function resetToken(_ref4) {\n    var commit = _ref4.commit;\n    return new Promise(function (resolve) {\n      commit('SET_TOKEN', '');\n      commit('SET_ROLES', []);\n      (0, _auth.removeToken)();\n      resolve();\n    });\n  }\n};\nvar _default = {\n  namespaced: true,\n  state: state,\n  mutations: mutations,\n  actions: actions\n};\nexports.default = _default;",{"version":3,"sources":["/Users/apple/WebstormProjects/vue-demo/erp-web/erp-web/src/store/modules/user.js"],"names":["state","token","name","avatar","roles","mutations","SET_TOKEN","SET_NAME","SET_AVATAR","SET_ROLES","actions","login","userInfo","commit","username","password","Promise","resolve","reject","trim","then","response","data","catch","err","error","logout","getUserInfo","length","resetToken","namespaced"],"mappings":"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","sourcesContent":["import {login, logout, getInfo} from '@/api/login/user'\nimport { getToken, setToken, removeToken } from '@/utils/auth'\nimport { resetRouter } from '@/router'\n\nconst state = {\n    token: getToken(),\n    name: '',\n    avatar: '',\n    roles: []\n}\n\nconst mutations = {\n    SET_TOKEN: (state, token) => {\n        state.token = token\n    },\n    SET_NAME: (state, name) => {\n        state.name = name\n    },\n    SET_AVATAR: (state, avatar) => {\n        state.avatar = avatar\n    },\n    SET_ROLES: (state, roles) => {\n        state.roles = roles\n    }\n}\n\nconst actions = {\n    login({commit}, userInfo){\n        const {username, password} = userInfo;\n        return new Promise((resolve, reject) => {\n            login({username: username.trim(), password: password }).then(response => {\n                const { data } = response;\n                commit(\"SET_TOKEN\", data.token);\n                setToken(data.token);\n                resolve();\n            }).catch(err => {\n                reject(error)\n            })\n        })\n    },\n    logout({commit}){\n        return new Promise((resolve, reject) => {\n            logout().then(response => {\n                commit('SET_TOKEN', '')\n                commit('SET_ROLES', [])\n                removeToken()\n                resetRouter()\n                resolve();\n            }).catch(error => {\n                reject(error)\n            })\n        })\n    },\n    getUserInfo({commit, state}){\n        return new Promise((resolve, reject) => {\n            getInfo(state.token).then(response => {\n                const { data } = response\n                if (!data) {\n                    reject('获取用户信息失败，请重新登陆！');\n                }\n                const {roles, name, avatar} = data\n                if (!roles || roles.length <= 0) {\n                    reject('getInfo: roles must be a non-null array!')\n                }\n                commit('SET_ROLES', roles)\n                commit('SET_NAME', name)\n                commit('SET_AVATAR', avatar)\n                resolve(data)\n            }).catch(error => {\n                reject(error)\n            })\n        })\n    },\n    resetToken({ commit }) {\n        return new Promise(resolve => {\n            commit('SET_TOKEN', '')\n            commit('SET_ROLES', [])\n            removeToken()\n            resolve()\n        })\n    }\n}\n\nexport default {\n    namespaced: true,\n    state,\n    mutations,\n    actions\n}"]}]}